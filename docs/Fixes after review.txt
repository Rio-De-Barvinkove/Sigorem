Детальний пофазовий план переходу Sigorem на повний Lay of the Land стиль
Тільки детальні тези, без жодного рядка коду. План розбитий на фази з підпунктами — роби строго по порядку, щоб нічого не зламалось.
Фаза 0: Підготовка та бекап (обов’язково)

Зроби повний бекап всього проекту (zip або git commit з тегом “pre-lotl”).
Переконайся, що voxel_world.tscn вже працює в блоковому режимі з твоїми текстурами, без червоних помилок.
Зроби voxel_world.tscn головною сценою (Project Settings → Run → Main Scene).
Заархівуй папку зі старим GridMap-світом (world.tscn + ChunkManager + ProceduralGeneration.gd) — знадобиться тільки для копіювання логіки.

Фаза 1: Заміна базового вузла на VoxelLodTerrain (LOD + smooth meshing)

Видали старий VoxelTerrain.
Додай новий вузол VoxelLodTerrain як кореневий terrain.
Підключи існуючий VoxelGeneratorAdapter до Stream.
Зміни Mesher на VoxelMesherTransvoxel.
Налаштуй LOD: lod_count = 4–6, block_size = 16 або 32, view_distance = 400–600, full_load_mode = Enabled.
Видали посилання на VoxelBlockyLibrary (воно більше не потрібне).
Запусти — має з’явитись сірий/чорний гладкий terrain (ще без текстур).

Фаза 2: Перехід генератора на SDF-логіку (гладкі пагорби + печери)

Зміни канал даних в генераторі: тільки CHANNEL_SDF (float-значення).
Перероби логіку заповнення вокселів: замість set_voxel(ID) — обчислення signed distance (відстань до поверхні).
Залиш FastNoiseLite/Simplex для heightmap, біомів і печер.
Додай 3D-шум для печер/overhangs (cellular або perlin).
Налаштуй висоту, частоту, октави так, щоб виглядало природно (гладкі пагорби 20–60 блоків висотою).
Тестуй генерацію — поверхня має бути повністю гладкою, без ступінчастих країв.

Фаза 3: Створення матеріалу та шейдера в стилі Lay of the Land

Створи новий ShaderMaterial (назови LotL_Terrain_Material).
Признач його як Material Override у VoxelLodTerrain.
В шейдері реалізуй triplanar mapping по WORLD_POSITION.
Використовуй Texture2DArray (4–6 шарів): grass, dirt, rock, moss, snow (опціонально).
Додай блендинг за нормалями: трава на горизонтальних поверхнях, камінь на крутих схилах.
Додай procedural moss: на пласких поверхнях + залежність від висоти + напрямку нормалі (північні схили).
Додай простий AO з SDF-каналу або baked.
Додай roughness/metallic варіації залежно від типу поверхні.
Налаштуй uv_scale (0.05–0.1) для правильного розміру текстур.

Фаза 4: Перенесення всіх систем з GridMap → VoxelLodTerrain

BuildController: переключи на VoxelTool (вже частково є), прибери весь GridMap-fallback.
PlayerController: реалізуй safe spawn (raycast вниз по SDF до поверхні).
Консоль команд: перенеси всі команди (/tp, /fill тощо) під VoxelTool (do_sphere, copy, paste тощо).
Інвентар / UI / HUD: скопіюй всі CanvasLayer, Control-вузли зі старої world.tscn в нову voxel_world.tscn.
Hotbar, блок-пікер: підключи до BuildController (вже має бути адаптовано під VoxelTool).
Система збереження/завантаження: якщо є — переключи на VoxelStream або простий save voxels.

Фаза 5: Розширена генерація та біоми в стилі LotL

Додай кілька шарів шуму для різних біомів (ліс, гори, пустеля).
Реалізуй блендинг текстур за біомами (наприклад, пісок в пустелі, сніг вище певної висоти).
Додай procedural деталі: трава/квіти як окремі VoxelInstancer (не в основному террейні).
Печери: зроби великі + маленькі, з різним порогом шуму.

Фаза 6: Оптимізація та фінальні штрихи

Увімкни LOD fading (в шейдері або в налаштуваннях Transvoxel).
Налаштуй fog + SSAO + bloom у WorldEnvironment для атмосферності.
Оптимізуй view_distance та lod_count під твій ПК/цільову платформу.
Додай water level (окремий PlaneMesh або другий VoxelLodTerrain з constant SDF).
Тестуй редагування великих ділянок (build/destroy) — не має бути лагів.

Фаза 7: Очищення старого коду

Видали повністю: ChunkManager.gd, ProceduralGeneration.gd (старий), GridMap-вузли.
Видали всі fallback-умови під GridMap в скриптах.
Перевір, щоб не лишилось жодного MeshLibrary або GridMap-залежностей.
Зроби фінальний git commit “full-lotl-complete”.